var slice=[].slice;define(["App"],function(e){return e.module("Service",function(n,r,u,l,t,a){var o,i,g,c,s,f,d,v,h,w,p,y,m,b;return b=e.vent,g=b.request("config"),h={},s=g.routes.error,f=g.routes.home,d=g.languagePattern,c=/\/\/+/g,m=/\/*$/g,v=/^\/*/g,p=null,y={route:"",raw:"",sub:[],subraw:"",language:g.defaultLanguage},i=function(e){return u.history.navigate(y.language+"/"+e)},o=function(e){return y.language=e,requirejs.config({config:{i18n:{locale:e}}})},w=function(e){return e.replace(c,"/").replace(m,"").replace(v,"")},b.reply("change:language",function(e,n){return null!=e?(null==n&&(n=y.raw),o(e),b.request("navigate",n,!0)):void 0}),b.reply("navigate:silent",function(e){var n;if(null!=e)return e=w(e),n=e.split("/"),y.raw=e,y.route=n[0],n=a.rest(n),y.subraw=n.join("/"),y.sub=n,i(e)}),b.reply("location",function(){return window.location.href}),b.reply("language",function(){return y.language}),b.reply("route",function(){return y.route}),b.reply("route:info",function(){return a.clone(y)}),b.reply("route:sub",function(){return y.subraw}),b.reply("route:full",function(){return y.raw}),a.each(g.modules,function(e,n){var r,u;if(u=e.split("@"),2!==u.length)throw new Error("invalid handler path '"+e+"'");return r=u[0].match(/^(\w+)\./),null!=r?h[n]={moduleName:r[1],event:u[1],ctor:u[0],route:n,ctrl:null}:void 0}),n.navigate=function(n,r){var l,c,v,m,q,j,D,L,M,N,k;return D=p,n=a.trim(n),n!==(null!=D?D.route:void 0)||r?(null!=D?(v=n.match(d),null!=v&&(n=v[2])):(k=u.history.fragment.match(d),y.language=null,null!=k&&(a.includes(g.languages,k[1])&&(y.language=k[1]),null==D&&(n=k[2])),null==y.language&&(y.language=g.defaultLanguage,i(n)),o(y.language)),""===n?(l=f,j=[]):(n=w(n),M=n.split("/"),l=M[0],j=2<=M.length?slice.call(M,1):[],null==j&&(j=[])),L=t.Deferred(),q=t.Deferred(),m=h[l],null==m&&(l=n=s,m=h[l]),p=m,require(["module/"+m.moduleName+"/index"],function(){return q.resolve(m)}),c=void 0,null!=D&&(b.trigger("route:destroy",y.route,y.sub,l,j),c=D.ctrl.triggerMethod("destroy:"+D.event,l,j)),null!=c?L=c:L.resolve(),N=t.Deferred(),t.when(L,q).always(function(u){return function(){var u,t;return null!=D&&i(n),null!=r?void window.location.reload():(null==m.ctrl&&(u=e.module(m.ctor),m.ctrl=new u),y.route=l,y.raw=n,y.subraw=j.join("/"),y.sub=j,t=m.ctrl.triggerMethod("show:"+m.event,j),b.trigger("route:show",l,j),null!=(null!=t?t.done:void 0)?t.done(N.resolve):N.resolve())}}(this)),N):void 0},u.history.handlers.push({route:/(.*)/,callback:function(e){return function(e){return n.navigate(e)}}(this)}),b.reply("navigate",n.navigate)})});